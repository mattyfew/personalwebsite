<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for pencilblue/include/error/errors_over_time.js</title>
    <meta charset="utf-8">

    <link rel="stylesheet" href="../../../prettify.css">

    <link rel="stylesheet" href="../../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header low">
    <h1>Code coverage report for <span class="entity">pencilblue/include/error/errors_over_time.js</span></h1>
    <h2>
        
        Statements: <span class="metric">25.71% <small>(9 / 35)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 10)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">11.11% <small>(1 / 9)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">25.71% <small>(9 / 35)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> &#187; <a href="index.html">pencilblue/include/error/</a> &#187; errors_over_time.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
    Copyright (C) 2015  PencilBlue, LLC
&nbsp;
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
&nbsp;
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
&nbsp;
    You should have received a copy of the GNU General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
*/
&nbsp;
module.exports = function ErrorsOverTimeModule(/*pb*/) {
&nbsp;
    /**
     * Wraps up code that allows developers the ability to time box errors.  In 
     * some instances errors will occur.  It is only when a certain number of those 
     * errors occur within a given time span that it is recognized that recovery is 
     * improbable.  When the threshold is broken the code allows you to throw an 
     * error that represents all others that contributed to the threshold breach.
     * @class ErrorsOverTime
     * @constructor
     * @param {Integer} errorSpan The upper bound on the number of errors that can 
     * occur within the provided time frame before it is determined that recovery 
     * is not possible.
     * @param {Integer} errorThreshold The upper bound on the amount of time, in 
     * milliseconds, that errors can occur in before it is determined that recovery 
     * is not possible.
     * @param {String} [prefix] The prefix to any error message that is generated 
     * by the instance
     */
<span class="fstat-no" title="function not covered" >    function ErrorsOverTime(errorSpan, errorThreshold, prefix) {</span>
&nbsp;
        /**
         * The upper bound on the number of errors that can occur within the provided 
         * time frame before it is determined that recovery is not possible.
         * @property errorSpan
         * @type {Integer}
         */
<span class="cstat-no" title="statement not covered" >        this.errorSpan = errorSpan;</span>
&nbsp;
        /**
         * The upper bound on the amount of time, in milliseconds, that errors can 
         * occur in before it is determined that recovery is not possible.
         * @property errorThreshold
         * @type {Integer}
         */
<span class="cstat-no" title="statement not covered" >        this.errorThreshold = errorThreshold;</span>
&nbsp;
        /**
         * The list of errors that will be used to determin if too many errors have 
         * occurred within a given time frame.
         * @property errors
         * @type {Array}
         */
<span class="cstat-no" title="statement not covered" >        this.errors = [];</span>
&nbsp;
        /**
         * The total number of errors that have occurred
         * @property totalErrorCnt
         * @type {Integer}
         */
<span class="cstat-no" title="statement not covered" >        this.totalErrorCnt = 0;</span>
&nbsp;
        /**
         * The prefix to any error message that is generated by the instance
         * @property prefix
         * @type {String}
         */
<span class="cstat-no" title="statement not covered" >        this.prefix = prefix;</span>
    };
&nbsp;
    /**
     * Adds an error into the calculation to determine if too many errors have 
     * occurred within a particular time span. If the threshold has been broken an 
     * error is thrown.
     * @method throwIfOutOfBounds
     * @param {Error} The error that occurred
     * @param {String} prefix The error message text that will come first
     * @return {Boolean} TRUE if threshold is in tact, FALSE if not
     */
    ErrorsOverTime.prototype.throwIfOutOfBounds = <span class="fstat-no" title="function not covered" >function(err, prefix) {</span>
<span class="cstat-no" title="statement not covered" >        if (!this.errorOccurred(err)) {</span>
<span class="cstat-no" title="statement not covered" >            ErrorsOverTime.generateError(this.errors, prefix || this.prefix);</span>
        }
<span class="cstat-no" title="statement not covered" >        return true;</span>
    };
&nbsp;
    /**
     * Adds an error into the calculation to determine if too many errors have 
     * occurred within a particular time span.
     * @method errorOccurred
     * @param {Error} The error that occurred
     * @return {Boolean} TRUE if threshold is in tact, FALSE if not
     */
    ErrorsOverTime.prototype.errorOccurred = <span class="fstat-no" title="function not covered" >function(err) {</span>
&nbsp;
        //add the error
<span class="cstat-no" title="statement not covered" >        this.totalErrorCnt++;</span>
<span class="cstat-no" title="statement not covered" >        this.errors.push(err);</span>
&nbsp;
        //shave off any errors that are outside of our span
<span class="cstat-no" title="statement not covered" >        if (this.errors.length &gt; this.errorSpan) {</span>
<span class="cstat-no" title="statement not covered" >            this.errors.splice(0, 1);</span>
        }
<span class="cstat-no" title="statement not covered" >        return this.isWithinLimits();</span>
    };
&nbsp;
    /**
     * Determines if the errors that have occurred are within the acceptable tolerance.
     * @method isWithinLimits
     * @return {Boolean} TRUE if threshold in tact, FALSE if not
     */
    ErrorsOverTime.prototype.isWithinLimits = <span class="fstat-no" title="function not covered" >function() {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        var withinLimits = true;</span>
<span class="cstat-no" title="statement not covered" >        if (this.errors.length &gt;= this.errorSpan) {</span>
<span class="cstat-no" title="statement not covered" >            withinLimits = this.getRange() &gt; this.errorThreshold;</span>
        }
<span class="cstat-no" title="statement not covered" >        return withinLimits;</span>
    };
&nbsp;
    /**
     * Gets the time span over which the current set of errors has occurred
     * @method getRange
     * @return {Integer} The number of milliseconds over which the last "n" number 
     * of errors have occurred where "n" is the value is between 0 and the value of 
     * the errorSpan property inclusive.
     */
    ErrorsOverTime.prototype.getRange = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >        return this.errors[this.errors.length - 1] - this.errors[this.errors.length - this.errorSpan];</span>
    };
&nbsp;
    /**
     * Generates and throws an Error that represents all of the errors that 
     * triggered the threshold breach.
     * @static
     * @method generateError
     * @param {Array} errors The array of errors that will be represented by one 
     * wrapper error
     * @param {String} prefix The error message text that will come first
     */
    ErrorsOverTime.generateError = <span class="fstat-no" title="function not covered" >function(errors, prefix) {</span>
<span class="cstat-no" title="statement not covered" >        throw ErrorsOverTime.createError(errors, prefix);</span>
    };
&nbsp;
    /**
     * Creates an Error that represents all of the errors that triggered the 
     * threshold breach.
     * @static
     * @method createError
     * @param {Array} errors The array of errors that will be represented by one 
     * wrapper error
     * @param {String} prefix The error message text that will come first
     * @return {Error}
     */
    ErrorsOverTime.createError = <span class="fstat-no" title="function not covered" >function(errors, prefix) {</span>
<span class="cstat-no" title="statement not covered" >        if (!prefix) {</span>
<span class="cstat-no" title="statement not covered" >            prefix = '';</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        var pattern = prefix + 'Threshold breached by:';</span>
<span class="cstat-no" title="statement not covered" >        errors.forEach(<span class="fstat-no" title="function not covered" >function(errItem) {</span></span>
<span class="cstat-no" title="statement not covered" >            pattern += '\n' + errItem.stack;</span>
        });
<span class="cstat-no" title="statement not covered" >        pattern += '\n----------------------------------------';</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return new Error(pattern);</span>
    };
&nbsp;
    return ErrorsOverTime;
};
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Oct 08 2015 17:49:20 GMT-0400 (EDT)</div>
</div>

<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>

<script src="../../../sorter.js"></script>
</body>
</html>
